# 🎯 请按这个步骤执行

## 📌 MySQL错误已解决

您的错误是：`Unknown column 'contact_person'`

**原因**：您的merchant表字段是 `contact_name`（不是 contact_person）

我已经准备好了正确的SQL！

---

## ✅ 步骤1：在MySQL中执行SQL

### 方法1：使用SQL文件（推荐）

1. 打开MySQL Workbench
2. 点击 File -> Open SQL Script
3. 选择文件：`F:\redame\demo\最简单的SQL-直接执行.sql`
4. 点击闪电图标⚡执行
5. 查看结果，应该显示商家和服务项目数据

### 方法2：直接复制粘贴

在MySQL中复制执行以下SQL：

```sql
USE motorcycle_service_platform;

-- 插入商家用户
INSERT INTO sys_user (username, password, phone, user_type, status, create_time, update_time)
SELECT 'merchant_test', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z2EE4lb8Qrx7hQo3DqsFy2/u', '13900000001', 2, 1, NOW(), NOW()
FROM DUAL
WHERE NOT EXISTS (SELECT 1 FROM sys_user WHERE username = 'merchant_test');

-- 插入商家数据
INSERT INTO merchant (
    merchant_name, user_id, contact_name, contact_phone, address, 
    latitude, longitude, location, business_hours, merchant_type, status
)
SELECT 
    '测试摩托维修店',
    (SELECT MIN(id) FROM sys_user WHERE user_type = 2 LIMIT 1),
    '张师傅',
    '13900139000',
    '北京市朝阳区建国路88号',
    39.904200, 116.407396,
    ST_GeomFromText('POINT(116.407396 39.904200)'),
    '09:00-20:00', 1, 1
FROM DUAL
WHERE NOT EXISTS (SELECT 1 FROM merchant WHERE merchant_name = '测试摩托维修店');

-- 插入服务项目
INSERT INTO service_item (item_name, description, price, status, create_time, update_time)
SELECT '常规保养', '更换机油机滤等', 200.00, 1, NOW(), NOW()
FROM DUAL
WHERE NOT EXISTS (SELECT 1 FROM service_item WHERE item_name = '常规保养');

INSERT INTO service_item (item_name, description, price, status, create_time, update_time)
SELECT '刹车维护', '更换刹车片刹车油', 300.00, 1, NOW(), NOW()
FROM DUAL
WHERE NOT EXISTS (SELECT 1 FROM service_item WHERE item_name = '刹车维护');

-- 验证数据
SELECT * FROM merchant;
SELECT * FROM service_item;
```

### ✅ 成功标志

执行成功后应该看到：
- merchant表有数据（至少1条）
- service_item表有数据（至少2条）

---

## ✅ 步骤2：启动后端

在PowerShell中执行：

```powershell
cd F:\redame\demo

# 停止旧进程
Get-Process -Name "java" -ErrorAction SilentlyContinue | Stop-Process -Force

# 启动后端
.\mvnw.cmd spring-boot:run
```

**等待看到这行**：
```
Started DemoApplication in X.XXX seconds
```

---

## ✅ 步骤3：测试功能

**打开新的PowerShell窗口**，执行：

```powershell
cd F:\redame\demo
.\test-register-and-appointment.ps1
```

### 🎉 成功标志

应该看到：

```
[SUCCESS] Register successful!
[SUCCESS] Login successful!
[SUCCESS] Appointment created!
Appointment ID: 1 (或其他数字)

ALL TESTS PASSED!
```

---

## ❌ 如果步骤1执行SQL时仍有错误

### 情况1：外键约束错误

如果提示 `Cannot add or update a child row`：

**临时解决**（执行SQL前先运行）：
```sql
SET FOREIGN_KEY_CHECKS=0;
-- 然后执行插入SQL
SET FOREIGN_KEY_CHECKS=1;
```

### 情况2：地理位置字段错误

如果提示 `location` 字段错误：

**简化版SQL**（不使用地理位置）：

先在MySQL中执行：
```sql
-- 临时修改merchant表，允许location为空
ALTER TABLE merchant MODIFY COLUMN location POINT NULL;
ALTER TABLE merchant MODIFY COLUMN latitude DECIMAL(10,6) NULL;
ALTER TABLE merchant MODIFY COLUMN longitude DECIMAL(10,6) NULL;
```

然后使用简化的插入SQL：
```sql
INSERT INTO merchant (merchant_name, user_id, contact_name, contact_phone, address, business_hours, merchant_type, status)
VALUES ('测试摩托维修店', 1, '张师傅', '13900139000', '北京市朝阳区建国路88号', '09:00-20:00', 1, 1)
ON DUPLICATE KEY UPDATE merchant_name=VALUES(merchant_name);
```

### 情况3：user_id不存在

查看sys_user表中是否有user_type=2的用户：
```sql
SELECT id, username, user_type FROM sys_user WHERE user_type = 2;
```

如果没有，先创建：
```sql
INSERT INTO sys_user (username, password, phone, user_type, status)
VALUES ('merchant_test', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z2EE4lb8Qrx7hQo3DqsFy2/u', '13900000001', 2, 1);
```

---

## 💡 快速检查命令

### 检查merchant表数据
```sql
SELECT id, merchant_name, contact_name FROM merchant;
```

### 检查service_item表数据
```sql
SELECT id, item_name, price FROM service_item;
```

---

## 📞 如果问题仍未解决

请提供：
1. **SQL执行的完整错误截图**
2. **merchant表的结构**：
   ```sql
   SHOW CREATE TABLE merchant;
   ```
3. **sys_user表的数据**：
   ```sql
   SELECT id, username, user_type FROM sys_user LIMIT 5;
   ```

---

**现在就开始执行步骤1！** 🚀




