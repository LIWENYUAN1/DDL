# 🚨 紧急！立即创建预约表

## ❌ 当前问题

**错误信息**：
```
Table 'motorcycle_service_platform.appointment' doesn't exist
```

**原因**：
您的数据库中缺少 `appointment` 和 `appointment_service_item` 两张表！

---

## ✅ 解决方案 - 3步搞定

### **第1步：打开Navicat**

1. 启动 Navicat Premium
2. 连接到您的MySQL数据库
3. 双击打开 `motorcycle_service_platform` 数据库

---

### **第2步：执行SQL脚本**

#### 方法1：直接执行（推荐）⭐

1. 在Navicat中，点击顶部菜单 **查询** → **新建查询**
2. 或按快捷键 `Ctrl+Q`
3. 将以下完整SQL复制粘贴到查询窗口：

```sql
-- ===================================================
-- 创建预约相关表 - 立即执行此SQL
-- ===================================================

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for appointment
-- ----------------------------
DROP TABLE IF EXISTS `appointment`;
CREATE TABLE `appointment` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '预约ID（主键）',
  `order_no` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '预约单号（唯一）',
  `user_id` bigint NOT NULL COMMENT '用户ID（关联sys_user表）',
  `merchant_id` bigint NOT NULL COMMENT '商家ID（关联merchant表）',
  `motorcycle_id` bigint NOT NULL COMMENT '车辆ID（关联motorcycle表）',
  `appointment_time` datetime NOT NULL COMMENT '预约服务时间',
  `appointment_type` tinyint NOT NULL DEFAULT 2 COMMENT '预约类型：1-立即服务，2-预约服务',
  `service_type` tinyint NOT NULL DEFAULT 1 COMMENT '服务方式：1-到店服务，2-上门服务',
  `service_address` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '服务地址',
  `contact_phone` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '联系电话',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL COMMENT '问题描述',
  `remark` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL COMMENT '备注',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '预约状态：0-待确认，1-已确认，2-进行中，3-已完成，4-已取消',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_order_no`(`order_no` ASC) USING BTREE,
  INDEX `idx_user_id`(`user_id` ASC) USING BTREE,
  INDEX `idx_merchant_id`(`merchant_id` ASC) USING BTREE,
  INDEX `idx_motorcycle_id`(`motorcycle_id` ASC) USING BTREE,
  INDEX `idx_appointment_time`(`appointment_time` ASC) USING BTREE,
  INDEX `idx_status`(`status` ASC) USING BTREE,
  CONSTRAINT `fk_appointment_user` FOREIGN KEY (`user_id`) REFERENCES `sys_user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `fk_appointment_merchant` FOREIGN KEY (`merchant_id`) REFERENCES `merchant` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `fk_appointment_motorcycle` FOREIGN KEY (`motorcycle_id`) REFERENCES `motorcycle` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '预约信息表' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Table structure for appointment_service_item
-- ----------------------------
DROP TABLE IF EXISTS `appointment_service_item`;
CREATE TABLE `appointment_service_item` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `appointment_id` bigint NOT NULL COMMENT '预约ID（关联appointment表）',
  `service_item_id` bigint NOT NULL COMMENT '服务项目ID（关联service_item表）',
  `service_price` decimal(10,2) NULL DEFAULT NULL COMMENT '服务价格（元）',
  `quantity` int NOT NULL DEFAULT 1 COMMENT '数量（默认1）',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_appointment_id`(`appointment_id` ASC) USING BTREE,
  INDEX `idx_service_item_id`(`service_item_id` ASC) USING BTREE,
  CONSTRAINT `fk_appointment_service_appointment` FOREIGN KEY (`appointment_id`) REFERENCES `appointment` (`id`) ON DELETE CASCADE ON UPDATE RESTRICT,
  CONSTRAINT `fk_appointment_service_item` FOREIGN KEY (`service_item_id`) REFERENCES `service_item` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '预约服务项目关联表' ROW_FORMAT = Dynamic;

SET FOREIGN_KEY_CHECKS = 1;

-- ===================================================
-- 表创建完成！
-- ===================================================

SELECT 'appointment 表创建成功！' AS 结果;
SELECT 'appointment_service_item 表创建成功！' AS 结果;
```

4. 点击 **运行** 按钮（绿色三角形）或按 `F5`
5. 等待执行完成

#### 方法2：执行SQL文件

1. 在Navicat中，右键点击 `motorcycle_service_platform` 数据库
2. 选择 **运行SQL文件**
3. 浏览并选择：`F:\redame\demo\创建预约表.sql`
4. 点击 **开始** 执行

---

### **第3步：验证表是否创建成功**

在Navicat中执行以下SQL验证：

```sql
-- 验证表是否存在
SHOW TABLES LIKE '%appointment%';

-- 查看appointment表结构
DESC appointment;

-- 查看appointment_service_item表结构
DESC appointment_service_item;
```

**预期结果**：
- ✅ 看到 `appointment` 表
- ✅ 看到 `appointment_service_item` 表
- ✅ 两个表的字段结构完整

---

## 🚀 完成后立即测试

### 无需重启后端！
后端已经在运行，表创建完成后直接测试即可。

### 测试步骤：

1. **打开前端**：`http://localhost:5175`
2. **登录用户**（任意普通用户）
3. **填写预约信息**：
   - 商家：选择任意商家
   - 服务：选择任意服务
   - 车型：`雅马哈 YZF-R1`
   - 车牌：`京A12345`
   - 时间：选择未来日期
   - 联系电话：填写手机号
   - 问题描述：例如"定期保养"
4. **提交预约**

### 预期结果：
- ✅ 看到"预约成功"提示
- ✅ 不再出现表不存在错误
- ✅ 数据成功保存

---

## 📊 查看预约数据

在Navicat中执行：

```sql
-- 查看最新的预约记录
SELECT 
    a.id AS 预约ID,
    a.order_no AS 预约单号,
    u.username AS 用户名,
    m.merchant_name AS 商家,
    a.appointment_time AS 预约时间,
    a.contact_phone AS 联系电话,
    a.description AS 问题描述,
    CASE a.status 
        WHEN 0 THEN '待确认'
        WHEN 1 THEN '已确认'
        WHEN 2 THEN '进行中'
        WHEN 3 THEN '已完成'
        WHEN 4 THEN '已取消'
    END AS 状态
FROM appointment a
LEFT JOIN sys_user u ON a.user_id = u.id
LEFT JOIN merchant m ON a.merchant_id = m.id
ORDER BY a.id DESC 
LIMIT 10;

-- 查看预约关联的服务项目
SELECT 
    asi.id AS ID,
    a.order_no AS 预约单号,
    si.item_name AS 服务项目,
    asi.service_price AS 价格,
    asi.quantity AS 数量
FROM appointment_service_item asi
LEFT JOIN appointment a ON asi.appointment_id = a.id
LEFT JOIN service_item si ON asi.service_item_id = si.id
ORDER BY asi.id DESC
LIMIT 10;
```

---

## 🔍 为什么会缺少这两个表？

**可能原因**：
1. 您的DDL.txt文件中没有包含这两个表的定义
2. 之前执行DDL时可能跳过了这些表
3. 数据库初始化不完整

**解决办法**：
- ✅ 现在已经为您创建了完整的SQL脚本
- ✅ 表结构完全匹配后端代码的要求
- ✅ 包含所有必要的外键约束和索引

---

## 📋 表结构说明

### `appointment` 表（预约信息表）
- 存储预约的基本信息
- 关联用户、商家、车辆
- 记录预约时间、联系方式、状态等

### `appointment_service_item` 表（预约服务项目关联表）
- 存储预约包含的服务项目
- 关联预约和服务项目
- 支持一个预约包含多个服务项目

---

## 🎯 立即操作清单

- [ ] 第1步：打开Navicat，连接数据库
- [ ] 第2步：新建查询，复制SQL并执行
- [ ] 第3步：验证表是否创建成功
- [ ] 第4步：在前端测试预约功能
- [ ] 第5步：在Navicat中查看预约数据

---

## 💡 遇到问题？

### 问题1：执行SQL时报错
**可能原因**：数据库权限不足  
**解决办法**：确保使用root用户或有CREATE TABLE权限的用户

### 问题2：外键约束失败
**可能原因**：缺少关联表（merchant、sys_user、motorcycle、service_item）  
**解决办法**：先确保这些表存在（应该已经存在）

### 问题3：表创建成功但预约仍然失败
**可能原因**：后端代码问题  
**解决办法**：查看后端控制台的详细错误信息

---

## 🎉 完成后的状态

表创建成功后，您的数据库应该包含：

- ✅ `sys_user` - 用户表
- ✅ `owner_info` - 车主信息表
- ✅ `merchant` - 商家表
- ✅ `motorcycle` - 车辆表
- ✅ `service_item` - 服务项目表
- ✅ `appointment` - **预约表（新建）**
- ✅ `appointment_service_item` - **预约服务关联表（新建）**

**现在预约功能的所有数据库表都齐全了！** 🚀

---

**立即执行SQL，然后告诉我结果！**


