# 🎯 摩托车服务平台功能完善计划

## 📋 当前问题
- ✅ 用户预约后无法录入数据库 ← **已有基础代码，需完善**
- ✅ 商家无法查看预约 ← **需创建商家端接口和页面**
- ✅ 管理员无法进行后台管理 ← **需创建管理员端接口和页面**
- ✅ 各角色之间缺乏交互 ← **需完善工作流程**

---

## 🏗️ 系统架构

### 三个角色
1. **👤 用户（User）** - userType = 1
   - 注册/登录
   - 创建预约
   - 查看我的预约
   - 取消预约
   - 查看附近商家
   - 评价服务

2. **🏪 商家（Merchant）** - userType = 2
   - 注册/登录
   - 查看预约列表
   - 确认预约
   - 完成服务
   - 拒绝预约
   - 管理服务项目
   - 查看营业数据

3. **👨‍💼 管理员（Admin）** - userType = 3
   - 登录（不需要注册，数据库预设）
   - 审核商家申请
   - 管理用户
   - 查看所有预约
   - 查看所有订单
   - 系统数据统计

---

## 📊 数据流程

### 完整业务流程

```
用户创建预约
    ↓
[存入appointment表，状态=0（待确认）]
    ↓
商家查看预约列表
    ↓
商家确认预约
    ↓
[更新appointment表，状态=1（已确认）]
    ↓
商家提供服务
    ↓
商家标记完成
    ↓
[更新appointment表，状态=2（已完成）]
[可选：创建order订单记录]
    ↓
用户评价（可选）
    ↓
[创建comment评价记录]
    ↓
管理员可查看所有记录
```

---

## 🔧 需要完善的后端功能

### 1. 商家管理 Controller & Service
```java
// MerchantController.java
- GET  /api/merchant/info - 获取商家信息
- PUT  /api/merchant/info - 更新商家信息
- GET  /api/merchant/appointments - 查看预约列表
- POST /api/merchant/appointments/{id}/confirm - 确认预约
- POST /api/merchant/appointments/{id}/complete - 完成预约
- POST /api/merchant/appointments/{id}/reject - 拒绝预约
- GET  /api/merchant/statistics - 营业统计
```

### 2. 用户预约 Controller（已有，需完善）
```java
// AppointmentController.java（已存在）
- POST /api/appointment/create - 创建预约 ✅
- GET  /api/appointment/user/list - 用户预约列表 ✅
- POST /api/appointment/cancel/{id} - 取消预约 ✅
- GET  /api/appointment/detail/{id} - 预约详情 ✅
```

### 3. 管理员管理 Controller
```java
// AdminController.java
- GET  /api/admin/merchants - 商家列表
- POST /api/admin/merchants/{id}/approve - 审核通过
- POST /api/admin/merchants/{id}/reject - 审核拒绝
- GET  /api/admin/users - 用户列表
- PUT  /api/admin/users/{id}/status - 修改用户状态
- GET  /api/admin/appointments - 所有预约
- GET  /api/admin/statistics - 平台数据统计
```

### 4. 公共 API
```java
// MerchantPublicController.java
- GET  /api/public/merchants - 查询附近商家（用户端使用）
- GET  /api/public/merchants/{id} - 商家详情
- GET  /api/public/merchants/{id}/services - 商家服务项目
```

---

## 🎨 需要完善的前端功能

### 1. 用户端页面（`/user/*`）
```vue
- UserHomeView.vue - 用户首页（查看附近商家）✅ 已有
- UserAppointmentsView.vue - 我的预约 📝 需完善
  - 预约列表（待确认、已确认、已完成、已取消）
  - 创建预约按钮
  - 取消预约功能
  
- CreateAppointmentView.vue - 创建预约 ⭐ 新增
  - 选择商家
  - 选择服务项目
  - 选择时间
  - 填写备注
  
- AppointmentDetailView.vue - 预约详情 ⭐ 新增
  - 显示预约信息
  - 显示商家信息
  - 显示服务项目
  - 取消预约按钮
```

### 2. 商家端页面（`/shop/*`）
```vue
- ShopHomeView.vue - 商家首页 ✅ 已有
  - 今日预约数
  - 待确认预约数
  - 营业数据

- ShopAppointmentsView.vue - 预约管理 📝 需完善
  - 预约列表（可按状态筛选）
  - 确认预约
  - 完成服务
  - 拒绝预约
  
- AppointmentDetailView.vue - 预约详情 ⭐ 新增
  - 查看用户信息
  - 查看车辆信息
  - 查看服务项目
  - 操作按钮（确认/完成/拒绝）

- ShopServicesView.vue - 服务项目管理 📝 需完善
  - 服务项目列表
  - 添加/编辑/删除服务项目

- ShopProfileView.vue - 商家信息 📝 需完善
  - 编辑商家信息
  - 上传营业执照
  - 设置营业时间
```

### 3. 管理员端页面（`/admin/*`）
```vue
- AdminHomeView.vue - 管理员首页 ✅ 已有
  - 平台数据统计
  - 待审核商家数
  - 今日预约数
  
- AdminUsersView.vue - 用户管理 📝 需完善
  - 用户列表
  - 搜索用户
  - 禁用/启用用户
  
- AdminShopsView.vue - 商家管理 📝 需完善
  - 商家列表
  - 审核商家（通过/拒绝）
  - 查看商家详情
  
- AdminAppointmentsView.vue - 预约管理 📝 需完善
  - 所有预约列表
  - 搜索预约
  - 查看预约详情
  
- AdminStatisticsView.vue - 数据统计 📝 需完善
  - 用户数量趋势
  - 预约数量趋势
  - 商家分布
  - 收入统计
```

---

## 🔐 权限配置更新

需要更新 `SecurityConfig.java`：

```java
// 用户端API
.requestMatchers("/api/appointment/**").hasAnyRole("USER", "ADMIN")

// 商家端API
.requestMatchers("/api/merchant/**").hasAnyRole("MERCHANT", "ADMIN")

// 管理员端API
.requestMatchers("/api/admin/**").hasRole("ADMIN")

// 公共API（不需要登录）
.requestMatchers("/api/public/**").permitAll()
```

---

## 📅 实施步骤

### Phase 1: 后端核心功能（2小时）
1. ✅ 完善AppointmentService（已完成）
2. ⭐ 创建MerchantController和Service
3. ⭐ 创建AdminController和Service
4. ⭐ 创建PublicController（公共API）
5. ⭐ 更新SecurityConfig权限配置

### Phase 2: 前端用户端（1小时）
1. ⭐ 完善UserAppointmentsView（我的预约）
2. ⭐ 创建CreateAppointmentView（创建预约）
3. ⭐ 创建AppointmentDetailView（预约详情）

### Phase 3: 前端商家端（1小时）
1. ⭐ 完善ShopAppointmentsView（预约管理）
2. ⭐ 创建ShopAppointmentDetailView（预约详情）
3. ⭐ 完善ShopServicesView（服务管理）

### Phase 4: 前端管理员端（1小时）
1. ⭐ 完善AdminUsersView（用户管理）
2. ⭐ 完善AdminShopsView（商家管理）
3. ⭐ 完善AdminAppointmentsView（预约管理）

### Phase 5: 测试和优化（30分钟）
1. ⭐ 测试完整流程
2. ⭐ 修复bug
3. ⭐ 优化体验

---

## 🎯 立即开始

我将按照以下顺序进行：

1. **创建MerchantController** - 商家端核心功能
2. **创建AdminController** - 管理员端核心功能  
3. **创建PublicController** - 公共API
4. **完善前端用户页面** - 用户创建预约和查看预约
5. **完善前端商家页面** - 商家查看和管理预约
6. **完善前端管理员页面** - 管理员审核和监控
7. **测试完整流程** - 确保所有功能正常工作

---

## 📌 注意事项

1. **数据库一致性**：确保所有操作都使用事务
2. **权限验证**：每个接口都要验证用户权限
3. **状态流转**：预约状态变更要遵循规则
4. **用户体验**：前端要有清晰的状态提示
5. **错误处理**：完善的错误提示和异常处理

---

**准备开始实施，预计总时间：5-6小时** ⏱️





