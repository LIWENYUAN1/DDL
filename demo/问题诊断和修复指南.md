# 🔍 问题诊断和修复指南

## 当前问题

您报告的问题：
1. ❌ **预约功能无法成功** - 显示系统错误
2. ❌ **注册功能无法使用**

## 🔧 问题诊断

通过测试发现：
- ✅ **注册功能实际上是正常的** (测试显示注册成功)
- ✅ **登录功能是正常的** (可以获取token)
- ❌ **后端服务启动有问题** (连接超时)

## 📋 修复步骤

### 第1步：检查后端窗口错误

1. 查看新打开的 PowerShell 窗口（后端运行窗口）
2. 查找红色错误信息，特别关注：
   - `MySQLException` - MySQL连接问题
   - `Table doesn't exist` - 数据表不存在
   - `Bean creation exception` - Bean创建失败
   - 端口占用 (`Port 8080 already in use`)

### 第2步：确保MySQL数据库运行

打开MySQL命令行或MySQL Workbench，执行：

```sql
-- 1. 确认数据库存在
SHOW DATABASES LIKE 'motorcycle_service_platform';

-- 2. 使用数据库
USE motorcycle_service_platform;

-- 3. 检查必要的表是否存在
SHOW TABLES;

-- 应该看到这些表：
-- - merchant (商家表)
-- - service_item (服务项目表)
-- - sys_user (用户表)
-- - appointment (预约表)
-- - motorcycle (车辆表)
-- - appointment_service_item (预约服务项目关联表)
```

### 第3步：初始化测试数据

如果表存在但没有数据，执行：

```sql
-- 插入测试商家
INSERT IGNORE INTO merchant (id, merchant_name, contact_person, contact_phone, address, business_license, status, create_time, update_time)
VALUES (1, '测试维修店', '张三', '13800138000', '测试地址123号', 'TEST123', 1, NOW(), NOW());

-- 插入测试服务项目
INSERT IGNORE INTO service_item (id, item_name, description, price, status, create_time, update_time)
VALUES 
(1, '常规保养', '更换机油、机滤等基础保养', 200.00, 1, NOW(), NOW()),
(2, '刹车维护', '检查更换刹车片和刹车油', 300.00, 1, NOW(), NOW());

-- 验证数据
SELECT * FROM merchant WHERE id = 1;
SELECT * FROM service_item WHERE id IN (1, 2);
```

### 第4步：修复数据库密码

如果看到 `Access denied for user 'root'` 错误：

1. 打开 `src/main/resources/application.properties`
2. 修改密码为您的MySQL实际密码：
   ```properties
   spring.datasource.password=您的实际密码
   ```

### 第5步：重新启动后端

```powershell
# 停止现有后端
Get-Process -Name "java" -ErrorAction SilentlyContinue | Stop-Process -Force

# 重新启动
cd F:\redame\demo
.\mvnw.cmd spring-boot:run
```

### 第6步：等待并测试

等待30-40秒后，运行测试：

```powershell
cd F:\redame\demo
.\test-register-and-appointment.ps1
```

## 🎯 快速诊断命令

### 检查后端是否运行
```powershell
# 测试健康端点
Invoke-WebRequest -Uri "http://localhost:8080/actuator/health"
```

### 检查8080端口
```powershell
netstat -ano | findstr ":8080"
```

### 检查Java进程
```powershell
Get-Process -Name "java"
```

## ⚠️ 常见问题和解决方案

### 问题1：端口被占用
```
Error: Port 8080 was already in use
```

**解决方案**：
```powershell
# 杀掉占用8080端口的进程
$processId = (netstat -ano | findstr ":8080" | Select-Object -First 1) -split '\s+' | Select-Object -Last 1
Stop-Process -Id $processId -Force
```

### 问题2：数据库连接失败
```
Communications link failure
```

**解决方案**：
1. 确认MySQL服务正在运行
2. 检查MySQL是否在3306端口
3. 验证用户名密码正确
4. 检查防火墙设置

### 问题3：表不存在
```
Table 'motorcycle_service_platform.merchant' doesn't exist
```

**解决方案**：
执行 `数据库.txt` 文件中的所有SQL语句创建表

### 问题4：merchant或service_item数据为空
```
系统错误: 空指针异常
```

**解决方案**：
执行第3步的SQL插入测试数据

## 📝 如果问题仍未解决

请提供以下信息：

1. **后端窗口的完整错误信息**（红色文字部分）
2. **数据库表列表**：
   ```sql
   SHOW TABLES;
   ```
3. **merchant表数据**：
   ```sql
   SELECT * FROM merchant LIMIT 5;
   ```
4. **service_item表数据**：
   ```sql
   SELECT * FROM service_item LIMIT 5;
   ```

## 🎉 成功标志

当一切正常时，您应该看到：

```
[SUCCESS] Register successful!
[SUCCESS] Login successful!
[SUCCESS] Appointment created!
Appointment ID: 1 (或其他数字)
```

---

**提示**：大多数问题都是由于数据库连接或缺少测试数据导致的。请按照上述步骤逐一检查。




