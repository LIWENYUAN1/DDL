# 🎯 快速启动评价功能

## ⚡ 两步完成

### **第1步：创建数据库表（1分钟）**

打开 Navicat，执行SQL：

```sql
DROP TABLE IF EXISTS `appointment_review`;
CREATE TABLE `appointment_review`  (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '评价ID',
  `appointment_id` bigint NOT NULL COMMENT '预约ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `merchant_id` bigint NOT NULL COMMENT '商家ID',
  `score` tinyint NOT NULL COMMENT '评分(1-5分)',
  `service_score` tinyint NULL COMMENT '服务评分',
  `quality_score` tinyint NULL COMMENT '质量评分',
  `attitude_score` tinyint NULL COMMENT '态度评分',
  `content` text NULL COMMENT '评价内容',
  `img_urls` varchar(1000) NULL COMMENT '评价图片',
  `reply_content` text NULL COMMENT '商家回复',
  `reply_time` datetime NULL COMMENT '回复时间',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态:0-隐藏,1-显示',
  `is_anonymous` tinyint NOT NULL DEFAULT 0 COMMENT '是否匿名',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `uk_appointment_id`(`appointment_id`),
  INDEX `idx_user_id`(`user_id`),
  INDEX `idx_merchant_id`(`merchant_id`),
  CONSTRAINT `fk_review_appointment` FOREIGN KEY (`appointment_id`) REFERENCES `appointment` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_review_user` FOREIGN KEY (`user_id`) REFERENCES `sys_user` (`id`),
  CONSTRAINT `fk_review_merchant` FOREIGN KEY (`merchant_id`) REFERENCES `merchant` (`id`)
) ENGINE = InnoDB CHARSET = utf8mb4 COMMENT = '预约评价表';
```

**验证**：
```sql
DESC appointment_review;
```

---

### **第2步：重启后端（1分钟）**

#### **IDEA中重启**：
1. 停止 DemoApplication（红色方块按钮）
2. 重新运行（绿色播放按钮）
3. 等待启动完成

#### **验证启动成功**：
浏览器访问：`http://localhost:8080`

---

## ✅ **完成！**

后端已准备就绪！

**现在等待我创建前端组件...**

---

## 📋 **已创建的后端文件**

1. ✅ `AppointmentReview.java` - 实体类
2. ✅ `AppointmentReviewDTO.java` - 数据传输对象
3. ✅ `AppointmentReviewMapper.java` - Mapper接口
4. ✅ `AppointmentReviewMapper.xml` - SQL映射
5. ✅ `AppointmentReviewService.java` - 服务接口
6. ✅ `AppointmentReviewServiceImpl.java` - 服务实现
7. ✅ `AppointmentReviewController.java` - 控制器
8. ✅ `ResultCode.java` - 添加评价错误码

---

## 🔍 **测试SQL**

创建完表后，可以测试插入数据：

```sql
-- 先完成一个预约（将状态改为已完成）
UPDATE appointment SET status = 3 WHERE id = 1;

-- 查看可评价的预约
SELECT 
    a.id,
    a.order_no,
    a.status,
    u.username,
    m.merchant_name
FROM appointment a
LEFT JOIN sys_user u ON a.user_id = u.id
LEFT JOIN merchant m ON a.merchant_id = m.id
WHERE a.status = 3;
```

---

**完成这两步后告诉我，我会继续创建前端评价组件！** 🚀


