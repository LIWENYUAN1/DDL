# 摩托车服务平台 - 登录注册功能测试指南

## 项目概述
本项目包含前端（Vue3 + TypeScript + Element Plus）和后端（Spring Boot + MyBatis Plus）两部分。

## 前置条件

### 1. 数据库配置
确保MySQL数据库已安装并运行，执行以下操作：

1. 创建数据库：
```sql
CREATE DATABASE motorcycle_service_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci;
```

2. 导入数据库脚本：
```bash
# 使用项目中的SQL文件
mysql -u root -p motorcycle_service_platform < demo/src/main/resources/motorcycle_service_platform.sql
```

3. 检查数据库配置（`demo/src/main/resources/application.properties`）：
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/motorcycle_service_platform?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=password  # 修改为你的MySQL密码
```

### 2. 后端启动

1. 进入后端目录：
```bash
cd demo
```

2. 启动Spring Boot应用：
```bash
# Windows
mvnw.cmd spring-boot:run

# Linux/Mac
./mvnw spring-boot:run
```

3. 验证后端启动成功：
   - 控制台显示 "Started DemoApplication"
   - 访问 http://localhost:8080 应该返回404（正常，因为没有配置根路径）

### 3. 前端启动

1. 进入前端目录：
```bash
cd vue-project
```

2. 安装依赖（首次运行）：
```bash
npm install
```

3. 启动开发服务器：
```bash
npm run dev
```

4. 访问前端应用：
   - 打开浏览器访问 http://localhost:5173
   - 或按控制台提示的端口访问

## 测试场景

### 场景1: 用户注册

#### 测试步骤：
1. 访问首页，点击"注册"或直接访问 http://localhost:5173/register
2. 选择"用户注册"（默认选中）
3. 填写注册信息：
   - 账号：`testuser1`（3-20个字符）
   - 验证码：输入显示的验证码（点击可刷新）
   - 密码：`Test123!`（至少6个字符，建议包含数字、字母）
   - 确认密码：`Test123!`
   - 姓名：`测试用户`
   - 手机号：`13800138001`（选填）
4. 勾选用户协议
5. 点击"立即注册"

#### 预期结果：
- 注册成功后显示成功消息
- 1.5秒后自动跳转到登录页
- 登录页的账号输入框自动填充注册的用户名

#### 后端验证：
```sql
-- 查看新注册的用户
SELECT * FROM sys_user WHERE username = 'testuser1';
```

### 场景2: 商家注册

#### 测试步骤：
1. 访问注册页面 http://localhost:5173/register
2. 选择"商家入驻"
3. 填写注册信息：
   - 账号：`testshop1`
   - 验证码：输入显示的验证码
   - 密码：`Test123!`
   - 确认密码：`Test123!`
   - 店铺名称：`测试商家`
   - 店铺地址：`云南省大理市下关镇测试路1号`
   - 联系人：`张三`
   - 联系电话：`13900139001`
   - 店铺描述：`专业摩托车维修服务`（选填）
4. 勾选用户协议
5. 点击"立即注册"

#### 预期结果：
- 注册成功后显示"商家注册成功，请等待审核"
- 自动跳转到登录页

#### 后端验证：
```sql
-- 查看新注册的商家用户
SELECT * FROM sys_user WHERE username = 'testshop1' AND user_type = 2;
```

### 场景3: 用户登录

#### 测试步骤：
1. 访问登录页面 http://localhost:5173/login
2. 选择"用户登录"标签页（默认）
3. 填写登录信息：
   - 账号：`testuser1`
   - 密码：`Test123!`
4. 勾选"记住密码"（可选）
5. 点击"登录"

#### 预期结果：
- 登录成功后显示成功消息
- 跳转到首页 http://localhost:5173/
- localStorage中保存了token和用户信息

#### 验证登录状态：
打开浏览器开发者工具（F12）-> Application/存储 -> Local Storage：
- `token`: JWT令牌
- `role`: `user`
- `userInfo`: 用户详细信息（JSON格式）

### 场景4: 商家登录

#### 测试步骤：
1. 访问登录页面
2. 选择"商家登录"标签页
3. 填写登录信息：
   - 账号：`testshop1`
   - 密码：`Test123!`
4. 点击"登录"

#### 预期结果：
- 登录成功
- role为`shop`

### 场景5: 管理员登录

#### 测试步骤：
1. 访问登录页面
2. 选择"管理员登录"标签页
3. 使用测试账号：
   - 账号：`admin`
   - 密码：需要查询数据库中的管理员账号
4. 点击"登录"

#### 预期结果：
- 登录成功
- role为`admin`

### 场景6: 错误处理测试

#### 6.1 用户名重复注册
- 使用已注册的用户名再次注册
- 预期：显示"该账号已被占用"或类似错误信息

#### 6.2 手机号重复注册
- 使用已注册的手机号再次注册
- 预期：显示"手机号已被注册"或类似错误信息

#### 6.3 密码不一致
- 注册时两次输入的密码不一致
- 预期：显示"两次输入的密码不一致"

#### 6.4 错误的登录凭证
- 使用错误的用户名或密码登录
- 预期：显示"用户名或密码错误"，并显示验证码

#### 6.5 验证码错误
- 连续登录失败后输入错误的验证码
- 预期：显示"验证码错误"，刷新验证码

#### 6.6 用户类型不匹配
- 使用普通用户账号在商家登录页登录
- 预期：显示"用户类型错误"

## 常见问题排查

### 问题1: 后端无法启动
**现象**: 控制台报错，无法启动Spring Boot应用

**解决方案**:
1. 检查MySQL是否运行：`mysql -u root -p`
2. 检查数据库是否创建：`SHOW DATABASES;`
3. 检查数据库密码配置是否正确
4. 查看完整的错误日志

### 问题2: 前端无法连接后端
**现象**: 登录/注册时显示网络错误

**解决方案**:
1. 确认后端已启动（http://localhost:8080）
2. 检查前端axios配置（`vue-project/src/utils/axios.ts`）中的baseURL
3. 检查浏览器控制台的Network标签，查看请求详情
4. 检查CORS配置（后端已配置，应该不会有跨域问题）

### 问题3: 注册成功但无法登录
**现象**: 注册显示成功，但登录时提示用户不存在

**解决方案**:
1. 查询数据库确认用户是否真的插入：
```sql
SELECT * FROM sys_user ORDER BY create_time DESC LIMIT 5;
```
2. 检查用户状态字段是否为1（启用）
3. 检查密码是否正确加密存储

### 问题4: Token无效或过期
**现象**: 登录成功但访问其他页面时提示未登录

**解决方案**:
1. 检查token是否正确保存到localStorage
2. 检查JWT配置是否正确
3. 检查token过期时间（默认24小时）

## API接口文档

### 1. 用户注册
- **接口**: `POST /auth/register`
- **请求体**:
```json
{
  "username": "testuser1",
  "password": "Test123!",
  "confirmPassword": "Test123!",
  "phone": "13800138001",
  "userType": 1,
  "code": "验证码（前端自己验证，后端暂不验证）"
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": true
}
```

### 2. 用户登录
- **接口**: `POST /auth/login`
- **请求体**:
```json
{
  "username": "testuser1",
  "password": "Test123!",
  "userType": 1
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "username": "testuser1",
    "phone": "13800138001",
    "userType": 1,
    "token": "eyJhbGciOiJIUzI1NiJ9..."
  }
}
```

## 下一步开发建议

1. **完善用户信息**:
   - 添加头像上传功能
   - 完善用户资料页面
   - 添加实名认证功能

2. **增强安全性**:
   - 实现真实的短信验证码
   - 添加图形验证码
   - 实现登录限流和防暴力破解
   - 添加密码强度验证

3. **改进用户体验**:
   - 添加第三方登录（微信、QQ等）
   - 实现"记住我"功能
   - 添加找回密码功能
   - 优化表单验证提示

4. **功能完善**:
   - 实现用户角色首页
   - 开发商家管理功能
   - 实现管理员后台
   - 添加预约、订单等核心功能

## 测试检查清单

- [ ] 数据库已创建并导入SQL脚本
- [ ] 后端成功启动（端口8080）
- [ ] 前端成功启动（端口5173或其他）
- [ ] 用户注册功能正常
- [ ] 商家注册功能正常
- [ ] 用户登录功能正常
- [ ] 商家登录功能正常
- [ ] 错误处理符合预期
- [ ] Token正确生成和保存
- [ ] 页面跳转逻辑正确

---

**文档版本**: v1.0  
**最后更新**: 2025年10月21日  
**维护者**: AI Assistant


